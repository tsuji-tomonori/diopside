language: python
type: application
tasks:
  diff:
    command: uv run --group infra cdk diff
    deps:
      - 'infra:layer'
      - 'web:build'
    inputs:
      - '@group(api-src)'
      - '@group(layer)'
      - '@group(web-src)'
      - '@group(infra-src)'
  deploy:
    command: uv run --group infra cdk deploy --all
    deps:
      - 'infra:layer'
      - 'web:build'
      - '~:diff'
    inputs:
      - '@group(api-src)'
      - '@group(layer)'
      - '@group(web-src)'
      - '@group(infra-src)'
