# 神経衰弱ゲーム画面仕様書

**URL**: `/memory`
**ファイル**: `package/web/src/app/memory/page.tsx`

## 1. 画面の役割（Why/What）

### 核心的役割
- **エンターテインメント**: 動画ブラウジングの息抜きとして、楽しいゲーム体験を提供
- **記憶トレーニング**: 白雪巴さんの動画サムネイルを使った記憶力向上ゲーム
- **ファンエンゲージメント**: 動画サムネイルを通じてファンとしての愛着度を深める

### 機能的役割
- **脳トレーニング**: 集中力・記憶力の向上
- **コンテンツ再発見**: ゲームを通じて過去の動画サムネイルとの再会
- **サイト滞在時間向上**: アーカイブサイトでの滞在体験を豊かにする

## 2. 機能詳細（How）

### 2.1 ゲーム設定機能
**コンポーネント**: Hero UI `Select` + `Card`

#### ペア数選択
- **選択肢**: 4ペア（8枚）/ 6ペア（12枚）/ 8ペア（16枚）/ 10ペア（20枚）
- **デフォルト**: 8ペア（中級レベル）
- **即座反映**: 選択と同時に新しいゲーム用画像を取得
- **新ゲームボタン**: 同じペア数で画像セットを更新

### 2.2 ゲーム実行機能
**コンポーネント**: `MemoryGame`

#### カード表示仕様
- **レイアウト**: 4列固定グリッド（`grid-cols-4`）
- **アスペクト比**: 正方形（`aspect-square`）
- **未開状態**: 紫グラデーション + "?" アイコン
- **開封状態**: 動画サムネイル画像表示
- **マッチング状態**: 画像表示継続 + 非操作状態

#### ゲームフロー
1. **初期化**: サムネイル配列をペア作成 → シャッフル
2. **カードクリック**: 最初のクリックでタイマー開始
3. **ペア判定**: 2枚開封時に1秒後判定実行
4. **マッチング**: 同画像なら固定、異なれば裏返し
5. **完了判定**: 全ペア完成でゲーム終了

#### ゲーム統計
- **手数カウント**: ペア判定1回につき手数+1
- **タイマー**: 初回クリック〜完了までの経過時間
- **結果表示**: 手数と時間をフォーマット表示

### 2.3 UI状態管理
**主要状態**:
- `pairs`: 選択中のペア数
- `gameStats`: 完了時の結果（手数・時間）
- `cards`: ゲーム中のカード状態配列
- `flippedCards`: 現在開封中のカードID
- `isProcessing`: ペア判定中の操作ブロック

### 2.4 API連携
- **エンドポイント**: `GET /api/videos/memory?pairs={pairs}`
- **レスポンス**: `MemoryThumbnailsResponse { thumbnails: string[] }`
- **画像形式**: 各サムネイルURLが2個ずつ配列に含まれる

## 3. デザイン・UI構成（Look & Feel）

### 3.1 全体的なデザイン言語
- **ゲーミフィケーション**: 楽しさとチャレンジ感を演出
- **直感的操作**: クリック・タップのみのシンプル操作
- **視覚的フィードバック**: アニメーション豊富な状態変化

### 3.2 レイアウト構造
```
MainLayout
├── Header Section
│   ├── Title: "神経衰弱ゲーム" (text-4xl, purple-800)
│   └── Subtitle: "白雪巴さんの動画サムネイルで神経衰弱を楽しもう"
├── Game Settings Card
│   ├── Puzzle Icon
│   ├── Pairs Selector (4/6/8/10ペア)
│   └── New Game Button
├── Game Stats Card (ゲーム完了時)
│   ├── Trophy Icon
│   ├── "ゲームクリア！"
│   ├── 手数表示
│   └── 時間表示 (MM:SS format)
├── Error/Loading States
├── MemoryGame Component
│   ├── Game Header (タイトル + 手数 + リセットボタン)
│   ├── Completion Banner (完了時)
│   └── Cards Grid (4列 × N行)
└── Instructions Card
    ├── Puzzle Icon + "遊び方"
    └── 4項目の説明
```

### 3.3 カラーパレット
- **アクセント**: 紫系統（purple-400〜purple-600）
- **成功**: 緑系統（green-50, green-800, yellow-500）
- **カード裏面**: 紫グラデーション（from-purple-400 to-purple-600）
- **テキスト**: グレー系統（適切なコントラスト確保）

### 3.4 アニメーション・インタラクション
- **カードフリップ**: `transition-all duration-300`
- **ホバー効果**: `hover:scale-102`（未開封時）
- **選択時効果**: `scale-105`（開封・マッチ時）
- **判定遅延**: 1秒のタイムアウトでペア判定実行
- **操作ブロック**: 判定中の `isProcessing` 状態

### 3.5 レスポンシブ対応
- **カードグリッド**: 4列固定（全デバイス共通）
- **カードサイズ**: 画面幅に応じて自動調整
- **余白**: `gap-3` で適切な間隔確保

## 4. 改善要件（Better UX）

### 4.1 ゲーム体験の向上
**現在の課題**: ゲーム終了後の満足感と継続動機が不十分

#### 提案改善
- **スコアシステム**: 手数・時間による点数計算
- **ランキング機能**: ローカルストレージでのベストスコア記録
- **難易度調整**: タイマー制限モード、ヒント機能
- **達成システム**: 連続クリア、高スコア等のバッジ機能

### 4.2 カスタマイゼーション機能
**現在の課題**: 固定的なゲーム設定で個人の好みに対応していない

#### 提案改善
- **テーマ選択**: カード裏面デザインのバリエーション
- **画像フィルタ**: 特定タグ・年度の動画のみでゲーム生成
- **レイアウト**: 3列・5列・6列等のグリッド選択肢
- **カスタム画像**: ユーザーお気に入り動画でのゲーム作成

### 4.3 ゲーム性の強化
**現在の課題**: 単純な神経衰弱のみで飽きやすい

#### 提案改善
- **ゲームモード追加**:
  - タイムアタック（制限時間内クリア）
  - パーフェクト（間違い禁止）
  - エンドレス（連続ペア数）
- **コンボシステム**: 連続正解でスコアボーナス
- **ヒント機能**: 一定手数後にヒント提供
- **リプレイ機能**: ゲーム過程の再生・共有

### 4.4 学習・記憶支援機能
**現在の課題**: 単なるゲームで学習効果が限定的

#### 提案改善
- **記憶術トレーニング**: 画像の特徴を覚えるためのコツ表示
- **進捗追跡**: 記憶力向上の可視化グラフ
- **間違い分析**: よく間違える画像パターンの分析
- **復習機能**: 過去にプレイした画像セットの再プレイ

### 4.5 ソーシャル・共有機能
**現在の課題**: 個人プレイのみで社会的要素がない

#### 提案改善
- **スコア共有**: Twitter/Discord等でのスコア投稿
- **チャレンジ機能**: 「この画像セットでチャレンジ」のURL共有
- **対戦モード**: 同じ画像セットでの時間・手数競争
- **コミュニティランキング**: 全ユーザーでのスコア比較

### 4.6 アクセシビリティ向上
**現在の課題**: 視覚的ゲームで障害者対応が不十分

#### 提案改善
- **キーボード操作**: Tab/Arrow キーでのカード選択
- **音声サポート**: 効果音・読み上げ機能
- **高コントラストモード**: 視覚障害者向けテーマ
- **操作ガイド**: 初回プレイ時のチュートリアル

### 4.7 パフォーマンス最適化
**現在の課題**: 大量の画像読み込みでパフォーマンス低下

#### 提案改善
- **画像プリロード**: ゲーム開始前の先読み込み
- **画像最適化**: WebP形式、適切なサイズリサイズ
- **メモリ管理**: 長時間プレイ時のメモリリーク対策
- **オフライン対応**: Service Worker でのキャッシュ機能

### 4.8 動画アーカイブとの連携強化
**現在の課題**: ゲーム画面が独立しており、他機能との連携が弱い

#### 提案改善
- **サムネイルクリック**: ゲーム中画像から動画詳細へのジャンプ
- **関連動画表示**: ゲーム完了後に使用動画の一覧表示
- **タグ学習**: ゲームを通じてタグ情報の学習
- **お気に入り連携**: ゲーム中に気になった動画のブックマーク

### 4.9 統計・分析機能
**現在の課題**: プレイデータの蓄積・活用がない

#### 提案改善
- **プレイ統計**: 総プレイ時間、平均手数、成功率
- **成長グラフ**: 記憶力スコアの時系列変化
- **画像記憶度**: 各サムネイルの記憶しやすさ指標
- **おすすめ難易度**: 統計に基づく最適ペア数提案

## 5. 技術的考慮事項

### 5.1 状態管理の最適化
- **React Reducer**: 複雑なゲーム状態の一元管理
- **カスタムフック**: ゲームロジックの再利用性向上
- **状態永続化**: ゲーム途中でのページリロード対応

### 5.2 画像読み込み最適化
- **Intersection Observer**: カード表示時の遅延読み込み
- **Error Boundary**: 画像読み込み失敗時の適切な処理
- **プレースホルダー**: 読み込み中の一時表示改善

### 5.3 ゲーム公平性
- **真の乱数**: crypto.getRandomValues() での確実なシャッフル
- **重複防止**: 同一画像セットの連続出現防止
- **バランス調整**: 難易度の客観的測定と調整
