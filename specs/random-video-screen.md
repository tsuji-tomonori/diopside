# ランダム動画画面仕様書

**URL**: `/random`
**ファイル**: `package/web/src/app/random/page.tsx`

## 1. 画面の役割（Why/What）

### 核心的役割
- **動画発見エンジン**: 膨大なアーカイブから偶然の出会いを創出
- **探索体験**: 目的意識のないブラウジングで新しい動画との遭遇機会を提供
- **コンテンツ再発見**: 埋もれがちな過去動画の掘り起こし

### 機能的役割
- **セレンディピティ**: 予期しない動画発見の楽しさ
- **アーカイブ活用**: 全期間の動画を平等に露出する機会創出
- **意思決定支援**: 「何を見ようか迷った時」の選択肢提供

## 2. 機能詳細（How）

### 2.1 表示数選択機能
**UI**: Hero UI `Select` コンポーネント

#### 選択肢詳細
- **1本**: 単一動画での集中発見体験
- **3本**: 軽いブラウジング、比較検討
- **5本**: 標準的な選択肢提供
- **10本**: 幅広い選択肢、一覧性重視

#### 動作仕様
- **デフォルト**: 1本（最もシンプルな体験から開始）
- **即座反映**: 選択変更と同時に新しい取得は行わず、次のシャッフル時に適用
- **Hero UI統一**: 他画面と同じ UI/UX パターン

### 2.2 シャッフル機能
**UI**: プライマリボタン + 回転アイコン

#### 動作フロー
1. **API呼び出し**: `/api/videos/random?count={count}` でランダム動画取得
2. **履歴保存**: 現在の動画を履歴配列に追加（最大50件）
3. **新規表示**: 新しく取得した動画を「今回の選出」として表示
4. **ローディング**: API通信中はボタンにスピナー表示

#### 履歴管理
- **保存件数**: 最大50件（`slice(0, 50)` で制限）
- **表示方式**: 新しいものから順に「過去の選出」セクションに表示
- **永続化**: 現在はセッション内のみ（ページリロードでリセット）

### 2.3 動画表示機能
**コンポーネント**: 共通 `VideoCard`

#### レイアウト仕様
- **今回の選出**: 大きめグリッド（〜5列）、中央寄せ
- **過去の選出**: 小さめグリッド（〜6列）、履歴表示
- **透明度差**: 履歴は `opacity-75` で現在選出と差別化
- **ホバー効果**: 履歴も `hover:opacity-100` でインタラクション提供

### 2.4 状態管理
**主要状態**:
- `count`: 選択中の表示数（1/3/5/10）
- `history`: 過去選出の動画配列（最大50件）
- `data`: 現在選出中の動画（SWR管理）

### 2.5 エンプティステート
**初回表示**: 動画が選択されていない状態

#### デザイン要素
- **大きな回転アイコン**: `w-16 h-16` サイズでインパクト
- **誘導メッセージ**: 「シャッフルして動画を発見しよう」
- **行動促進**: 「最初のシャッフル」ボタンで明確な次のアクション提示

## 3. デザイン・UI構成（Look & Feel）

### 3.1 全体的なデザイン言語
- **発見の楽しさ**: 予期しない出会いのワクワク感を演出
- **カジュアル感**: 気軽に何度でも試せる親しみやすさ
- **直感的操作**: シャッフルというメタファーの一貫性

### 3.2 レイアウト構造
```
MainLayout
├── Header Section
│   ├── Title: "ランダム動画" (text-4xl, purple-800)
│   └── Subtitle: "ランダムに選ばれた動画で新しい発見を"
├── Controls Card
│   ├── Shuffle Icon
│   ├── Count Selector (1/3/5/10本)
│   └── Shuffle Button (loading対応)
├── Error State (conditional)
├── Loading State (conditional)
├── Current Selection Section
│   ├── "今回の選出" Header
│   └── VideoGrid (lg:grid-cols-4 xl:grid-cols-5)
├── History Section (conditional)
│   ├── "過去の選出" Header
│   └── VideoGrid (lg:grid-cols-4 xl:grid-cols-6, opacity-75)
├── Instructions Card
│   ├── Play Icon + "使い方"
│   └── 4項目の使用方法説明
└── Empty State (conditional)
    ├── Large Shuffle Icon
    ├── Encouraging Message
    └── Primary Action Button
```

### 3.3 視覚的階層
1. **第1階層**: シャッフルボタン（最重要アクション）
2. **第2階層**: 今回の選出（メインコンテンツ）
3. **第3階層**: 設定・説明（サポート機能）
4. **第4階層**: 過去選出（参考情報）

### 3.4 インタラクション設計
- **シャッフルボタン**:
  - 通常: `color="primary" variant="flat"`
  - ローディング: `isLoading={isLoading}` でスピナー
  - アイコン: 回転アイコンで機能を直感的に表現
- **動画カード**: 過去選出の透明度変化でヒエラルキー表現
- **エンプティステート**: 大きなボタンで初回行動を促進

### 3.5 レスポンシブ対応
- **今回選出**: `sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5`
- **過去選出**: `sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6`
- **コントロール**: モバイルでもタップしやすいサイズ維持

## 4. 改善要件（Better UX）

### 4.1 発見体験の強化
**現在の課題**: 完全ランダムで文脈や関連性がない

#### 提案改善
- **スマートランダム**: ユーザーの閲覧履歴を考慮した「偏りのあるランダム」
- **テーマ別ランダム**: 「ゲーム実況から」「歌配信から」等のカテゴリ指定
- **時系列ランダム**: 「1年前の今日」「デビュー初期」等の時期指定
- **気分ランダム**: 「元気が出る動画」「癒し系動画」等の感情軸での選択

### 4.2 発見履歴の活用
**現在の課題**: 履歴が単純な時系列表示のみで活用されていない

#### 提案改善
- **履歴分析**: 「よく発見するタグ」「発見パターン」の可視化
- **再発見防止**: 最近発見した動画の重複出現を制御
- **お気に入りマーク**: 履歴から気に入った動画の即座マーキング
- **履歴検索**: 過去に発見した動画の検索・フィルタ機能

### 4.3 ソーシャル・共有機能
**現在の課題**: 個人的発見で共有・コミュニケーション要素がない

#### 提案改善
- **発見共有**: 「今日のランダム発見」のSNS投稿機能
- **発見チャレンジ**: 「1日1発見」等のチャレンジ企画
- **みんなの発見**: 他ユーザーの発見動画の共有フィード
- **発見コメント**: 発見した動画への簡易コメント機能

### 4.4 発見ゲーミフィケーション
**現在の課題**: 継続利用のモチベーション維持機構がない

#### 提案改善
- **発見バッジ**: 「初期動画発見者」「レア動画ハンター」等の称号
- **発見カウンター**: 総発見数、連続発見日数等の記録
- **発見レベル**: 発見経験値によるレベルアップシステム
- **発見ミッション**: 「古い動画を5本発見」等の目標設定

### 4.5 パーソナライゼーション
**現在の課題**: 全ユーザー共通の体験で個人の嗜好に対応していない

#### 提案改善
- **発見設定**: 好みのジャンル・除外したいタグの設定
- **時間帯考慮**: 現在時刻に適した動画（朝は短め、夜は長め等）
- **デバイス考慮**: モバイル時は短い動画優先等
- **学習機能**: クリック・視聴行動から好み自動学習

### 4.6 発見アルゴリズムの改良
**現在の課題**: 単純な等確率ランダムで偏りや戦略性がない

#### 提案改善
- **重み付けランダム**: 人気度・新しさ・希少性による確率調整
- **多様性保証**: 同じタグ・年度の連続出現を制限
- **季節性考慮**: 現在の季節・イベントに関連する動画の優遇
- **バランス調整**: 新旧・人気不人気のバランス考慮

### 4.7 コンテンツ理解支援
**現在の課題**: 発見した動画の背景・文脈が分からない

#### 提案改善
- **動画解説**: なぜこの動画が選ばれたかの説明
- **関連情報**: 同時期の他動画、シリーズ動画等の情報
- **タグ説明**: 表示タグの意味・背景の説明
- **統計情報**: この動画の人気度・希少度等の客観データ

### 4.8 発見後のアクション
**現在の課題**: 発見後の次のアクションが不明確

#### 提案改善
- **ワンクリック視聴**: 外部サイトへの適切なリンク
- **類似動画**: 「この動画が気に入ったら」の関連推薦
- **プレイリスト**: 発見動画を使ったプレイリスト自動生成
- **メモ機能**: 発見動画への個人的メモ・タグ付け

### 4.9 統計・分析ダッシュボード
**現在の課題**: 発見活動の成果・傾向が見えない

#### 提案改善
- **発見統計**: 月別発見数、カテゴリ別発見傾向等
- **発見マップ**: どの年度・タグを多く発見しているかの可視化
- **発見効果**: 発見を通じて知った新情報・好みの変化
- **発見レポート**: 定期的な発見活動サマリーの自動生成

### 4.10 技術的改善
**現在の課題**: APIレスポンス速度とキャッシュ効率

#### 提案改善
- **プリフェッチ**: 次回シャッフル用動画の事前取得
- **インテリジェントキャッシュ**: 発見済み動画の効率的キャッシュ
- **オフライン対応**: ネットワーク不安定時の発見継続
- **A/Bテスト**: 発見アルゴリズムの効果測定・改善

## 5. 技術的考慮事項

### 5.1 ランダム性の品質
- **真の乱数**: 暗号学的安全な乱数生成器の使用
- **アルゴリズム検証**: ランダム性の統計的検証
- **重複防止**: 短期間での同動画出現防止

### 5.2 パフォーマンス最適化
- **API効率化**: バッチ取得によるリクエスト削減
- **メモリ管理**: 大量履歴蓄積時のメモリ使用量制御
- **画像最適化**: サムネイル画像の効率的読み込み

### 5.3 データプライバシー
- **ローカル保存**: 発見履歴の適切なローカル管理
- **匿名化**: 統計目的での個人情報保護
- **オプトアウト**: 履歴機能の無効化オプション
